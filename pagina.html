<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reproductor DBZ ‚Äî Pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --bg:#f6f7fb; --ink:#2d2a32; --muted:#6b6a73; --panel:#ffffff; --edge:#e9e8f2; --accent:#b59bff; }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; color:var(--ink);
      background:
        radial-gradient(1000px 1000px at 10% -10%, #efeaff 0%, transparent 55%),
        radial-gradient(900px 900px at 100% 0%, #e3fff7 0%, transparent 55%),
        linear-gradient(180deg,var(--bg),#fdfcff 60%);
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .player{ background:var(--panel); border:1px solid var(--edge); border-radius:22px; box-shadow:0 10px 30px rgba(23,15,41,.08); max-width:960px; width:100% }
    .header{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 16px;
      background:linear-gradient(135deg, color-mix(in oklch,var(--accent), white 20%), color-mix(in oklch,var(--accent), black 8%)); color:#2b223d }
    .title{ margin:0; font-size:16px; font-weight:700; letter-spacing:.3px }
    .badge{ font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.65); border:1px solid rgba(0,0,0,.05) }

    .stage{ position:relative; background:#000 }
    video{ width:100%; height:auto; display:block; background:#000; position:relative; z-index:1 }
    .center-play{ position:absolute; inset:0; display:grid; place-items:center; pointer-events:none }
    .center-play .btn-big{ pointer-events:auto; --size:72px; width:var(--size); height:var(--size); border-radius:999px; border:none; display:grid; place-items:center; font-size:28px; color:white; background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.45)); box-shadow:0 10px 30px rgba(0,0,0,.2) }

    .controls{ display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:14px 16px; padding:14px 16px 12px }
    .row{ display:flex; align-items:center; gap:8px }
    .btn{ --size:40px; width:var(--size); height:var(--size); display:grid; place-items:center; border-radius:12px; border:1px solid var(--edge); background:linear-gradient(180deg,#fff,#fafafe); box-shadow:0 6px 16px rgba(23,15,41,.08); cursor:pointer; color:var(--ink) }
    .btn[aria-pressed="true"]{ outline:2px solid color-mix(in oklch,var(--accent),white 15%) }

    .seek{ grid-column:1/-1; display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px }
    .time{ font-variant-numeric:tabular-nums; color:var(--muted); font-size:14px; min-width:70px; text-align:center }
    .range{ position:relative; height:22px; display:grid; align-items:center }
    .buffered,.progress{ pointer-events:none; position:absolute; left:0; height:4px; border-radius:999px }
    .buffered{ width:0%; background:#e8e7f4 } .progress{ width:0%; background:var(--accent) }
    input[type="range"].slider{-webkit-appearance:none; appearance:none; width:100%; height:4px; background:transparent; outline:none}
    input[type="range"].slider::-webkit-slider-thumb{-webkit-appearance:none; width:16px; height:16px; border-radius:50%; background:white; border:2px solid var(--accent); box-shadow:0 2px 6px rgba(0,0,0,.12); margin-top:-6px}
    .vol{width:min(180px,25vw)}
    input[type="range"].vol-slider{-webkit-appearance:none; appearance:none; width:100%; height:4px; background:#efeef8; border-radius:999px}
    input[type="range"].vol-slider::-webkit-slider-thumb{ width:14px; height:14px; border-radius:50%; background:var(--accent) }

    .select{ padding:8px 10px; border-radius:12px; border:1px solid var(--edge); background:linear-gradient(180deg,#fff,#fafafe); color:var(--ink) }
    .foot{ color:var(--muted); font-size:13px; padding:0 16px 16px }

    /* Subt√≠tulos overlay */
    .captions{ position:absolute; left:0; right:0; bottom:6%; display:flex; flex-direction:column; gap:6px; align-items:center; padding:0 12px; z-index:5; pointer-events:auto }
    .cap-line{ max-width:min(86%, 900px); width:fit-content; color:#111; font-weight:600; letter-spacing:.2px; line-height:1.35; border-radius:14px; padding:8px 12px; box-shadow:0 6px 20px rgba(0,0,0,.16) }
    .track-ja{ background:rgba(255,255,255,.92) }
    .track-romaji{ background:rgba(255,245,232,.95) }
    .track-es{ background:rgba(236,253,245,.95) }

    .word-ja{ cursor:pointer; padding:0 2px; border-radius:6px }
    .word-ja:hover{ background:rgba(0,0,0,.06) }
    .track-romaji .word-ro{ pointer-events:none; cursor:default; padding:0 2px; border-radius:6px }

    /* highlight sincronizado */
    .hl { outline:2px solid color-mix(in oklch,var(--accent),white 15%); background:rgba(181,155,255,.12); border-radius:6px }

    /* Popover (solo JA) */
    .popover{ position:absolute; z-index:10; min-width:220px; max-width:320px; background:#fff; border:1px solid var(--edge); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.15); padding:10px 12px; display:none }
    .popover .word{ font-weight:800 } .popover .hint{ color:var(--muted); font-size:12px }
    .popover .meaning{ margin-top:6px }

    /* Badges peque√±os (romaji sugerido) */
    .ro-badge{ margin-left:8px; font-size:12px; padding:2px 6px; border-radius:999px; border:1px solid var(--edge); background:#fff }

    /* Diagn√≥stico oculto */
    .diag{ display:none; }
    .pill{ padding:4px 8px; border-radius:999px; border:1px solid var(--edge); background:#f7f7ff; white-space:nowrap }
    .tools{ display:flex; gap:8px; padding:0 16px 16px; flex-wrap:wrap }
    .tools .btn{ height:auto; padding:8px 12px; width:auto }

    ruby{ ruby-position:over; } rt{ font-size:.65em; color:#6b6a73 }
  </style>
</head>
<body>
  <div class="player" id="player" tabindex="0" aria-label="Reproductor de video con subt√≠tulos y panel flotante">
    <div class="header">
      <h1 class="title">Proyecto integral ‚Äî Reproductor</h1>
      <span class="badge" id="badgeDur">00:00</span>
    </div>

    <div class="stage">
      <video id="video" preload="metadata" playsinline webkit-playsinline poster="poster.jpg">
        <source id="src" src="video.mp4" type="video/mp4" />
        <!-- Pistas (mismo origen) -->
        <track id="trk-ja" label="Êó•Êú¨Ë™û"   kind="subtitles" srclang="ja"      src="subs-ja.vtt" default />
        <track id="trk-ro" label="R≈çmaji"  kind="subtitles" srclang="ja-Latn" src="subs-ro.vtt" />
        <track id="trk-es" label="Espa√±ol" kind="subtitles" srclang="es"      src="subs-es.vtt" />
        Tu navegador no soporta la etiqueta <code>video</code>.
      </video>

      <div class="center-play"><button class="btn-big" id="bigPlay" title="Reproducir">‚ñ∂</button></div>

      <div class="captions" id="captions">
        <div class="cap-line track-ja"     id="cap-ja" hidden></div>
        <div class="cap-line track-romaji" id="cap-romaji" hidden></div>
        <div class="cap-line track-es"     id="cap-es" hidden></div>
      </div>

      <div class="popover" id="popover">
        <div><span class="word" id="pv-word">‚Äî</span></div>
        <div class="hint" id="pv-read">Lectura: ‚Äî</div>
        <div class="meaning" id="pv-meaning">Significado: ‚Äî</div>
      </div>
    </div>

    <div class="controls" role="group" aria-label="Controles">
      <div class="row">
        <button class="btn" id="back10" title="Retroceder 10s">‚ü≤</button>
        <button class="btn" id="play"   title="Reproducir/Pausar"><span id="icon-play">‚ñ∂</span></button>
        <button class="btn" id="fwd10"  title="Avanzar 10s">‚ü≥</button>
      </div>
      <div class="row seek" aria-label="Barra de progreso">
        <div class="time" id="currentTime">0:00</div>
        <div class="range">
          <div class="buffered" id="bufferedBar"></div>
          <div class="progress" id="progressBar"></div>
          <input id="seek" class="slider" type="range" min="0" max="1000" step="1" value="0" />
        </div>
        <div class="time" id="duration">0:00</div>
      </div>
      <div class="row">
        <button class="btn" id="mute" title="Silenciar/Activar">üîä</button>
        <div class="vol"><input id="volume" class="vol-slider" type="range" min="0" max="1" step="0.01" value="1" /></div>
      </div>
      <div class="row">
        <select id="speed" class="select" aria-label="Velocidad">
          <option value="0.5">0.5√ó</option>
          <option value="0.75">0.75√ó</option>
          <option value="1" selected>1√ó</option>
          <option value="1.25">1.25√ó</option>
          <option value="1.5">1.5√ó</option>
          <option value="1.75">1.75√ó</option>
          <option value="2">2√ó</option>
        </select>
        <!-- Independientes: pod√©s combinar JA/RO/ES + Furigana -->
        <button class="btn" id="tog-ja"      aria-pressed="true"  title="Alternar Japon√©s">JA</button>
        <button class="btn" id="tog-romaji"  aria-pressed="false" title="Alternar R≈çmaji">RO</button>
        <button class="btn" id="tog-es"      aria-pressed="false" title="Alternar Espa√±ol">ES</button>
        <button class="btn" id="tog-fg"      aria-pressed="false" title="Furigana en JA">FG</button>
        <button class="btn" id="fs"          title="Pantalla completa">‚§¢</button>
      </div>
    </div>

    <div class="tools">
      <button class="btn" id="btnTest">Probar video de prueba (MDN)</button>
      <button class="btn" id="btnURL">Cargar por URL‚Ä¶</button>
      <span class="pill" id="statusSrc">src: video.mp4</span>
      <span class="pill" id="pillJA">JA: ‚Äî</span>
      <span class="pill" id="pillRO">RO: ‚Äî</span>
      <span class="pill" id="pillES">ES: ‚Äî</span>
    </div>
    <div class="diag" id="diag"></div>

    <div class="foot">Atajos: Espacio ¬∑ ‚Üê/‚Üí ¬±5s ¬∑ ‚Üë/‚Üì volumen ¬∑ M mute ¬∑ F pantalla completa ¬∑ J/A/E alternar JA/RO/ES ¬∑ G furigana</div>
  </div>


<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const player=$('#player'), video=$('#video'), srcEl=$('#src');

  /* ======== Diccionario JA‚áÑRO ======== */
  const JA_DICT={
    "Â≠´ÊÇüÈ£Ø":{yomi:"„Åù„Çì„Åî„ÅØ„Çì",gloss:"Son Gohan (nombre propio)", ro:"son gohan"},
    "Ê≠£„Åó„ÅÑ":{yomi:"„Åü„Å†„Åó„ÅÑ",gloss:"correcto; justo", ro:"tadashii"},
    "„Åì„Å®":{yomi:"„Åì„Å®",gloss:"cosa; hecho", ro:"koto"},
    "„Åü„ÇÅ„Å´":{yomi:"„Åü„ÇÅ„Å´",gloss:"para; por el bien de", ro:"tame ni"},
    "Êà¶„ÅÜ":{yomi:"„Åü„Åü„Åã„ÅÜ",gloss:"pelear; luchar", ro:"tatakau"},
    "ÁΩ™":{yomi:"„Å§„Åø",gloss:"pecado; culpa", ro:"tsumi"},
    "„Åß„ÅØ„Å™„ÅÑ":{yomi:"„Åß„ÅØ„Å™„ÅÑ",gloss:"no es; no ser", ro:"de wa nai"},
    "Ë©±„ÅóÂêà„ÅÑ":{yomi:"„ÅØ„Å™„Åó„ÅÇ„ÅÑ",gloss:"di√°logo; discusi√≥n", ro:"hanashiai"},
    "„Å™„Å©":{yomi:"„Å™„Å©",gloss:"etc.; cosas como ~", ro:"nado"},
    "ÈÄöÁî®„Åó„Å™„ÅÑ":{yomi:"„Å§„ÅÜ„Çà„ÅÜ„Åó„Å™„ÅÑ",gloss:"no funciona; no surte efecto", ro:"tsuuyou shinai"},
    "Áõ∏Êâã":{yomi:"„ÅÇ„ÅÑ„Å¶",gloss:"oponente; interlocutor", ro:"aite"},
    "„ÇÇ„ÅÑ„Çã„ÅÆ„Å†":{yomi:"„ÇÇ„ÅÑ„Çã„ÅÆ„Å†",gloss:"tambi√©n hay (explicativo)", ro:"mo iru no da"},
    "„ÅÑ„Çã„ÅÆ„Å†":{yomi:"„ÅÑ„Çã„ÅÆ„Å†",gloss:"(alguien) est√° (explicativo)", ro:"iru no da"},
    "Á≤æÁ•û":{yomi:"„Åõ„ÅÑ„Åó„Çì",gloss:"esp√≠ritu; mente", ro:"seishin"},
    "ÂÖâ":{yomi:"„Å≤„Åã„Çä",gloss:"luz", ro:"hikari"},
    "Ëá™Áî±„Å´":{yomi:"„Åò„ÇÜ„ÅÜ„Å´",gloss:"libremente", ro:"jiyuu ni"},
    "Ëß£Êîæ„Åó„Å¶„ÇÑ„Çå":{yomi:"„Åã„ÅÑ„Åª„ÅÜ„Åó„Å¶„ÇÑ„Çå",gloss:"lib√©ralo / d√©jalo libre", ro:"kaihou shite yare"},
    "Ê∞óÊåÅ„Å°":{yomi:"„Åç„ÇÇ„Å°",gloss:"sentimiento", ro:"kimochi"},
    "ÂàÜ„Åã„Çã":{yomi:"„Çè„Åã„Çã",gloss:"entender", ro:"wakaru"},
    "„ÇÇ„ÅÜ":{yomi:"„ÇÇ„ÅÜ",gloss:"ya / m√°s", ro:"mou"},
    "ÊàëÊÖ¢„Åô„Çã":{yomi:"„Åå„Åæ„Çì„Åô„Çã",gloss:"aguantarse / soportar", ro:"gaman suru"},
    "„Åì„Å®„ÅØ„Å™„ÅÑ":{yomi:"„Åì„Å®„ÅØ„Å™„ÅÑ",gloss:"no hace falta / no es necesario", ro:"koto wa nai"},
    "„ÅÆ„Åå":{yomi:"„ÅÆ„Åå",gloss:"(genitivo + „Åå)", ro:"no ga"},
    "„Åæ„Åæ":{yomi:"„Åæ„Åæ",gloss:"tal cual / en ese estado", ro:"mama"},
    "„ÅÆ„Åæ„Åæ":{yomi:"„ÅÆ„Åæ„Åæ",gloss:"tal cual / en ese estado", ro:"no mama"},
    /* Part√≠culas con variantes */
    "„ÅØ":{yomi:"„ÅØ",gloss:"marcador de tema", ro:"wa"},
    "„Åå":{yomi:"„Åå",gloss:"marcador de sujeto", ro:"ga"},
    "„ÇÇ":{yomi:"„ÇÇ",gloss:"tambi√©n", ro:"mo"},
    "„ÅÆ":{yomi:"„ÅÆ",gloss:"posesivo / explicativo", ro:"no"},
    "„Å´":{yomi:"„Å´",gloss:"direcci√≥n / destino", ro:"ni"},
    "„Åß":{yomi:"„Åß",gloss:"lugar / medio", ro:"de"},
    "„Å∏":{yomi:"„Å∏",gloss:"direcci√≥n (hacia)", ro:"e"},
    "„Å®":{yomi:"„Å®",gloss:"y / con", ro:"to"},
    "„Åã„Çâ":{yomi:"„Åã„Çâ",gloss:"desde", ro:"kara"},
    "„Åæ„Åß":{yomi:"„Åæ„Åß",gloss:"hasta", ro:"made"},
    "„Çà„Çä":{yomi:"„Çà„Çä",gloss:"comparativo (m√°s que)", ro:"yori"},
    "„Çí":{yomi:"„Çí",gloss:"objeto directo", ro:"o", rov:["wo"]} // soporta 'o' y 'wo'
  };
  const DICT_KEYS=Object.keys(JA_DICT).sort((a,b)=>b.length-a.length);

  /* === Normalizador de r≈çmaji === */
  const norm = (s)=>{
    if(!s) return '';
    const mac = {'ƒÄ':'aa','ƒÅ':'aa','ƒ™':'ii','ƒ´':'ii','≈™':'uu','≈´':'uu','ƒí':'ee','ƒì':'ee','≈å':'ou','≈ç':'ou'};
    s = s.replace(/[ƒÄƒÅƒ™ƒ´≈™≈´ƒíƒì≈å≈ç]/g, ch => mac[ch] || ch);
    return s.toLowerCase()
            .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
            .replace(/[^a-z0-9]/g,'');
  };

  /* === √çndice de r≈çmaji ‚Üí entrada === */
  const RO_INDEX={};
  for(const [k,v] of Object.entries(JA_DICT)){
    const base = norm(v.ro||'');
    if(base) RO_INDEX[base]=k;
    if(v.rov){ v.rov.forEach(r=>{ RO_INDEX[norm(r)]=k; }); }
  }

  // A partir de ac√° manten√©s tu l√≥gica de renderizado, highlight y popover,
  // usando JA_DICT y RO_INDEX para los clics en JA y en romaji.
})();
</script>

</body>
</html>


